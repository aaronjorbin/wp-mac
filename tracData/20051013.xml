<?xml version="1.0"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0">
  <channel>
    <title>WordPress Trac</title>
    <link>http://core.trac.wordpress.org/timeline</link>
    <description>Trac Timeline</description>
    <language>en-US</language>
    <generator>Trac 1.2.2</generator>
    <image>
      <title>WordPress Trac</title>
      <url>http://core.trac.wordpress.org/chrome/site/your_project_logo.png</url>
      <link>http://core.trac.wordpress.org/timeline</link>
    </image>
    <item>
      <title>functions-post.php.diff attached to Ticket #1758</title>
      
        <dc:creator>nessence</dc:creator>

      <pubDate>Thu, 13 Oct 2005 21:16:20 GMT</pubDate>
      <link>http://core.trac.wordpress.org/attachment/ticket/1758/functions-post.php.diff</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/attachment/ticket/1758/functions-post.php.diff/1129238180000000</guid>
      <description>&lt;p&gt;
diff file for ticket &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1758" title="#1758: defect (bug): thread safe wp_attach_object (closed: fixed)"&gt;#1758&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>attachment</category>
    </item><item>
      <title>Ticket #1758 (thread safe wp_attach_object) created</title>
      
        <dc:creator>nessence</dc:creator>

      <pubDate>Thu, 13 Oct 2005 21:15:50 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1758</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1758/1129238150000000</guid>
      <description>&lt;p&gt;
Attached is a diff file (generated using &lt;code&gt;svn diff -r HEAD functions-post.php &amp;gt; functions-post.php.diff&lt;/code&gt;)
&lt;/p&gt;
&lt;p&gt;
Please see ticket &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1753" title="#1753: defect (bug): INSERT queries which are not thread safe (closed: fixed)"&gt;#1753&lt;/a&gt; for more information. This diff also removes redundant sanitation of the $post_name. The $alt_post_name and empty($post_name) checks seem to provide the same functionality. Excepting a post saved with no name, for which the post_ID is no longer used, albeit this is probably watched in other places and you could easily add another condition to the $alt_post_name code. Objects may not always be images and may thus necessitate a 'draft' status; so I also applied the draft condition check &lt;em&gt;from&lt;/em&gt; the wp_insert_post function &lt;em&gt;to&lt;/em&gt; the wp_attach_object function.
&lt;/p&gt;
&lt;p&gt;
(sorry I took so long to submit some code (6 months!), I had a few mishaps)
&lt;/p&gt;
</description>
      <category>newticket</category>
    </item><item>
      <title>Ticket #1757 (Category caculation not right) created</title>
      
        <dc:creator>Melodiefabrieknl</dc:creator>

      <pubDate>Thu, 13 Oct 2005 19:33:25 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1757</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1757/1129232005000000</guid>
      <description>&lt;p&gt;
On my site I have this subcategory 'Propellerhead Reason' showing it contains 29 posts. If I check the Admin-page (Manage-Categories) it states 30 posts!
&lt;/p&gt;
&lt;p&gt;
This seems to be a bug. Are the developers aware of it?
&lt;/p&gt;
</description>
      <category>newticket</category>
    </item><item>
      <title>Ticket #1756 (page can not be deleted) created</title>
      
        <dc:creator>Melodiefabrieknl</dc:creator>

      <pubDate>Thu, 13 Oct 2005 19:31:08 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1756</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1756/1129231868000000</guid>
      <description>&lt;p&gt;
check this:
&lt;a class="ext-link" href="http://melodiefabriek.nl/test/"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://melodiefabriek.nl/test/&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;
this page 'test' is no longer available in Wordpress.
&lt;/p&gt;
&lt;p&gt;
but when I create a folder on the server with the 'test' name, it shows different content, which makes sense. but when I delete it from the server, the post re-appears but is not available in Wordpress. it is NOT available under Manage -&amp;gt; Pages!
&lt;/p&gt;
&lt;p&gt;
feels like a bug.
&lt;/p&gt;
</description>
      <category>newticket</category>
    </item><item>
      <title>Ticket #1755 (page can not be deleted) created</title>
      
        <dc:creator>Melodiefabrieknl</dc:creator>

      <pubDate>Thu, 13 Oct 2005 19:30:33 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1755</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1755/1129231833000000</guid>
      <description>&lt;p&gt;
check this:
&lt;a class="ext-link" href="http://melodiefabriek.nl/test/"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://melodiefabriek.nl/test/&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;
this page 'test' is no longer available in Wordpress.
&lt;/p&gt;
&lt;p&gt;
but when I create a folder on the server with the 'test' name, it shows different content, which makes sense. but when I delete it from the server, the post re-appears but is not available in Wordpress. it is NOT available under Manage -&amp;gt; Pages!
&lt;/p&gt;
&lt;p&gt;
feels like a bug.
&lt;/p&gt;
</description>
      <category>newticket</category>
    </item><item>
      <title>Ticket #1753 (INSERT queries which are not thread safe) closed</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Thu, 13 Oct 2005 19:06:32 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1753</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1753/1129230392000000</guid>
      <description>fixed: &lt;p&gt;
(In &lt;a class="changeset" href="http://core.trac.wordpress.org/changeset/2948" title="Remove thread unsafe Auto_increment tricks.  fixes #1753"&gt;[2948]&lt;/a&gt;) Remove thread unsafe Auto_increment tricks.  fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1753" title="#1753: defect (bug): INSERT queries which are not thread safe (closed: fixed)"&gt;#1753&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>closedticket</category>
    </item><item>
      <title>Changeset [2948]: Remove thread unsafe Auto_increment tricks.  fixes #1753</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Thu, 13 Oct 2005 19:06:31 GMT</pubDate>
      <link>http://core.trac.wordpress.org/changeset/2948</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/changeset/2948/1129230391975344</guid>
      <description>&lt;p&gt;
Remove thread unsafe Auto_increment tricks.  fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1753" title="#1753: defect (bug): INSERT queries which are not thread safe (closed: fixed)"&gt;#1753&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>changeset</category>
    </item><item>
      <title>Ticket #1750 (Category cleanup) closed</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Thu, 13 Oct 2005 18:59:11 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1750</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1750/1129229951000000</guid>
      <description>fixed: &lt;p&gt;
(In &lt;a class="changeset" href="http://core.trac.wordpress.org/changeset/2947" title="Oops.  Patch didn't apply cleanly.  fixes #1750"&gt;[2947]&lt;/a&gt;) Oops.  Patch didn't apply cleanly.  fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1750" title="#1750: defect (bug): Category cleanup (closed: fixed)"&gt;#1750&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>closedticket</category>
    </item><item>
      <title>Changeset [2947]: Oops.  Patch didn't apply cleanly.  fixes #1750</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Thu, 13 Oct 2005 18:59:10 GMT</pubDate>
      <link>http://core.trac.wordpress.org/changeset/2947</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/changeset/2947/1129229950164728</guid>
      <description>&lt;p&gt;
Oops.  Patch didn't apply cleanly.  fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1750" title="#1750: defect (bug): Category cleanup (closed: fixed)"&gt;#1750&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>changeset</category>
    </item><item>
      <title>Ticket #1753 (INSERT queries which are not thread safe) updated</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Thu, 13 Oct 2005 18:18:30 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1753</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1753/1129227510000000</guid>
      <description>&lt;i&gt;Owner&lt;/i&gt;, &lt;i&gt;Milestone&lt;/i&gt; changed&lt;br/&gt;</description>
      <category>editedticket</category>
    </item><item>
      <title>Ticket #1750 (Category cleanup) closed</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Thu, 13 Oct 2005 18:17:06 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1750</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1750/1129227426000000</guid>
      <description>fixed: &lt;p&gt;
(In &lt;a class="changeset" href="http://core.trac.wordpress.org/changeset/2946" title="Category insert cleanup from donncha. fixes #1750"&gt;[2946]&lt;/a&gt;) Category insert cleanup from donncha. fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1750" title="#1750: defect (bug): Category cleanup (closed: fixed)"&gt;#1750&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>closedticket</category>
    </item><item>
      <title>Changeset [2946]: Category insert cleanup from donncha. fixes #1750</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Thu, 13 Oct 2005 18:17:05 GMT</pubDate>
      <link>http://core.trac.wordpress.org/changeset/2946</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/changeset/2946/1129227425245203</guid>
      <description>&lt;p&gt;
Category insert cleanup from donncha. fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1750" title="#1750: defect (bug): Category cleanup (closed: fixed)"&gt;#1750&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>changeset</category>
    </item><item>
      <title>Ticket #1754 (Feature request: pass reason for moderation/spam flag) created</title>
      
        <dc:creator>dougal</dc:creator>

      <pubDate>Thu, 13 Oct 2005 18:12:39 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1754</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1754/1129227159000000</guid>
      <description>&lt;p&gt;
It could be useful for anti-spam plugins if the reason(s) for why a comment was flagged as spam could be retrieved. For example, whether the match occured in the content, URI, email address, client IP, etc., and which moderation/blacklist term matched.
&lt;/p&gt;
&lt;p&gt;
This would assist in identifying the cause of a false-positive match, and the aggregated data could also be used to analyze which terms are matched most often.
&lt;/p&gt;
</description>
      <category>newticket</category>
    </item><item>
      <title>Ticket #1753 (INSERT queries which are not thread safe) created</title>
      
        <dc:creator>nessence</dc:creator>

      <pubDate>Thu, 13 Oct 2005 17:42:44 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1753</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1753/1129225364000000</guid>
      <description>&lt;p&gt;
The example code below appears in multiple places (most importantly, in functions-post.php):
&lt;/p&gt;
&lt;pre class="wiki"&gt;        // Get the FOO ID.
        if ( $update ) {
                $FOO_ID = $ID;
        } else {
                $id_result = $wpdb-&amp;gt;get_row("SHOW TABLE STATUS LIKE '$wpdb-&amp;gt;FOOs'");
                $FOO_ID = $id_result-&amp;gt;Auto_increment;
        }
&lt;/pre&gt;&lt;p&gt;
This is not thread safe and most importantly may cause other problems in a multi-user environment. Because apache is a multi-threaded environment, if two users tried to post at the same time, they could get assigned the same '$id_result'.
&lt;/p&gt;
&lt;p&gt;
One solution is mysql's automatic incrementing. Your query would change from
&lt;/p&gt;
&lt;p&gt;
"INSERT INTO $wpdb-&amp;gt;posts
(ID, post_author, post_date, ...)
VALUES
('$post_ID', '$post_author', '$post_date', ...)";
&lt;/p&gt;
&lt;p&gt;
to
&lt;/p&gt;
&lt;p&gt;
"INSERT INTO $wpdb-&amp;gt;posts
(post_author, post_date, ...)
VALUES
('$post_author', '$post_date', ...)";
&lt;/p&gt;
&lt;p&gt;
Doing so causes mysql to automatically update the ID. The current manual process sort of negates auto_increment properties in the table creation schema. Safely handling the auto increment without using the SQL above would require an additional sequence table in mysql which handles IDs OR inserting the row before the post is finished and then modify the values of that row.
&lt;/p&gt;
&lt;p&gt;
How are you to handle this? I would suggest the above SQL corrections. If you require persistance of the row ID after you insert the post, you can always (carefully) use the &lt;a class="ext-link" href="http://us2.php.net/mysql_insert_id"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://us2.php.net/mysql_insert_id&lt;/a&gt; function.
&lt;/p&gt;
&lt;p&gt;
I will gladly provide a patch, however I don't know the entire code base and am not sure why the current method is being used.
&lt;/p&gt;
&lt;p&gt;
This is not an issue when a persistent mysql connection is being used on a non-threaded web server. This is a likely a major issue for apache and a critical issue for environments when PHP is executed as an CGI.
&lt;/p&gt;
</description>
      <category>newticket</category>
    </item><item>
      <title>diff.txt attached to Ticket #1750</title>
      
        <dc:creator>donncha</dc:creator>

      <pubDate>Thu, 13 Oct 2005 16:27:46 GMT</pubDate>
      <link>http://core.trac.wordpress.org/attachment/ticket/1750/diff.txt</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/attachment/ticket/1750/diff.txt/1129220866000000</guid>
      <description>&lt;p&gt;
wp_insert_category() cleanup
&lt;/p&gt;
</description>
      <category>attachment</category>
    </item><item>
      <title>Ticket #1715 (pluggable function replace error) updated</title>
      
        <dc:creator>skeltoac</dc:creator>

      <pubDate>Wed, 12 Oct 2005 21:52:04 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1715</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1715/1129153924000000</guid>
      <description>&lt;i&gt;Owner&lt;/i&gt; changed&lt;br/&gt;</description>
      <category>editedticket</category>
    </item><item>
      <title>Ticket #1752 (Hook for plugin activation/initial setup) closed</title>
      
        <dc:creator>error</dc:creator>

      <pubDate>Wed, 12 Oct 2005 21:17:04 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1752</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1752/1129151824000000</guid>
      <description>duplicate: &lt;p&gt;
hm, this code's already in wp-admin/plugins.php. sorry!
&lt;/p&gt;
</description>
      <category>closedticket</category>
    </item><item>
      <title>Ticket #1752 (Hook for plugin activation/initial setup) created</title>
      
        <dc:creator>error</dc:creator>

      <pubDate>Wed, 12 Oct 2005 21:10:09 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1752</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1752/1129151409000000</guid>
      <description>&lt;p&gt;
I propose a hook for activating a plugin. The hook would be called whenever a plugin is activated, with the name (or possibly filename) of the plugin as its argument. A plugin could then know it has just been activated, and take any initial setup steps it needs to take to configure itself without user intervention, or possibly to redirect the user to the plugin's options if necessary. (Spam Karma 2 needs this, for instance.)
&lt;/p&gt;
</description>
      <category>newticket</category>
    </item><item>
      <title>Ticket #1742 (Change all stray http://wordpress.org to http://wordpress.org/) closed</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Wed, 12 Oct 2005 18:21:19 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1742</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1742/1129141279000000</guid>
      <description>fixed: &lt;p&gt;
(In &lt;a class="changeset" href="http://core.trac.wordpress.org/changeset/2945" title="Trailing slashes, on the URI, make me happy, make me feel fine.  fixes ..."&gt;[2945]&lt;/a&gt;) Trailing slashes, on the URI, make me happy, make me feel fine.  fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1742" title="#1742: defect (bug): Change all stray http://wordpress.org to http://wordpress.org/ (closed: fixed)"&gt;#1742&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>closedticket</category>
    </item><item>
      <title>Changeset [2945]: Trailing slashes, on the URI, make me happy, make me feel fine.  fixes ...</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Wed, 12 Oct 2005 18:21:15 GMT</pubDate>
      <link>http://core.trac.wordpress.org/changeset/2945</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/changeset/2945/1129141275520226</guid>
      <description>&lt;p&gt;
Trailing slashes, on the URI, make me happy, make me feel fine.  fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1742" title="#1742: defect (bug): Change all stray http://wordpress.org to http://wordpress.org/ (closed: fixed)"&gt;#1742&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>changeset</category>
    </item><item>
      <title>Ticket #1751 (Fix AJAX category form) closed</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Wed, 12 Oct 2005 17:04:28 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1751</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1751/1129136668000000</guid>
      <description>fixed: &lt;p&gt;
(In &lt;a class="changeset" href="http://core.trac.wordpress.org/changeset/2944" title="Add admin-db include. Props donncha. fixes #1751"&gt;[2944]&lt;/a&gt;) Add admin-db include. Props donncha. fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1751" title="#1751: defect (bug): Fix AJAX category form (closed: fixed)"&gt;#1751&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>closedticket</category>
    </item><item>
      <title>Changeset [2944]: Add admin-db include. Props donncha. fixes #1751</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Wed, 12 Oct 2005 17:04:27 GMT</pubDate>
      <link>http://core.trac.wordpress.org/changeset/2944</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/changeset/2944/1129136667455169</guid>
      <description>&lt;p&gt;
Add admin-db include. Props donncha. fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1751" title="#1751: defect (bug): Fix AJAX category form (closed: fixed)"&gt;#1751&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>changeset</category>
    </item><item>
      <title>Ticket #1746 (Massive Code Cleanup: template-functions-author.php and ...) closed</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Wed, 12 Oct 2005 17:01:52 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1746</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1746/1129136512000000</guid>
      <description>fixed: &lt;p&gt;
(In &lt;a class="changeset" href="http://core.trac.wordpress.org/changeset/2943" title="Code cleanup from Mark Jaquith.  fixes #1746"&gt;[2943]&lt;/a&gt;) Code cleanup from Mark Jaquith.  fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1746" title="#1746: defect (bug): Massive Code Cleanup: template-functions-author.php and ... (closed: fixed)"&gt;#1746&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>closedticket</category>
    </item><item>
      <title>Changeset [2943]: Code cleanup from Mark Jaquith.  fixes #1746</title>
      
        <dc:creator>ryan</dc:creator>

      <pubDate>Wed, 12 Oct 2005 17:01:50 GMT</pubDate>
      <link>http://core.trac.wordpress.org/changeset/2943</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/changeset/2943/1129136510551251</guid>
      <description>&lt;p&gt;
Code cleanup from Mark Jaquith.  fixes &lt;a class="closed ticket" href="http://core.trac.wordpress.org/ticket/1746" title="#1746: defect (bug): Massive Code Cleanup: template-functions-author.php and ... (closed: fixed)"&gt;#1746&lt;/a&gt;
&lt;/p&gt;
</description>
      <category>changeset</category>
    </item><item>
      <title>Ticket #1745 (commentsrss should pull post custom for each comment's parent post) updated</title>
      
        <dc:creator>dougal</dc:creator>

      <pubDate>Wed, 12 Oct 2005 14:52:39 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1745</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1745/1129128759000000</guid>
      <description>&lt;i&gt;Keywords&lt;/i&gt; changed&lt;br/&gt;</description>
      <category>editedticket</category>
    </item><item>
      <title>Ticket #1751 (Fix AJAX category form) created</title>
      
        <dc:creator>donncha</dc:creator>

      <pubDate>Wed, 12 Oct 2005 11:12:16 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1751</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1751/1129115536000000</guid>
      <description>&lt;p&gt;
A function in edit-form-ajax-cat.php is in admin-db.php, need to include that file for ajax category stuff to work.
&lt;/p&gt;
&lt;pre class="wiki"&gt;--- trunk/wp-admin/edit-form-ajax-cat.php	2005-10-11 09:08:37 UTC (rev 396)
+++ trunk/wp-admin/edit-form-ajax-cat.php	2005-10-11 15:34:15 UTC (rev 397)
@@ -1,6 +1,7 @@
 &amp;lt;?php
 require_once('../wp-config.php');
 require_once('admin-functions.php');
+require_once('admin-db.php');
 get_currentuserinfo();
&lt;/pre&gt;</description>
      <category>newticket</category>
    </item><item>
      <title>Ticket #1750 (Category cleanup) created</title>
      
        <dc:creator>donncha</dc:creator>

      <pubDate>Wed, 12 Oct 2005 11:09:59 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1750</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1750/1129115399000000</guid>
      <description>&lt;p&gt;
Here's a patch that cleans up wp_insert_category()
&lt;/p&gt;
&lt;pre class="wiki"&gt;--- trunk/wp-inst/wp-admin/admin-db.php	2005-10-11 09:08:37 UTC (rev 396)
+++ trunk/wp-inst/wp-admin/admin-db.php	2005-10-11 15:34:15 UTC (rev 397)
@@ -92,16 +92,14 @@
 		$update = true;
 	} else {
 		$update = false;
-		$id_result = $wpdb-&amp;gt;get_row("SHOW TABLE STATUS LIKE '$wpdb-&amp;gt;categories'");
-		$cat_ID = $id_result-&amp;gt;Auto_increment;
 	}
 	$cat_name = wp_specialchars($cat_name);
 	if (empty ($category_nicename))
-		$category_nicename = sanitize_title($cat_name, $cat_ID);
+		$category_nicename = sanitize_title($cat_name);
 	else
-		$category_nicename = sanitize_title($category_nicename, $cat_ID);
+		$category_nicename = sanitize_title($category_nicename);
 	if (empty ($category_description))
 		$category_description = '';
@@ -109,18 +107,22 @@
 	if (empty ($category_parent))
 		$category_parent = 0;
-	if (!$update)
-		$query = "INSERT INTO $wpdb-&amp;gt;categories (cat_ID, cat_name, category_nicename, category_description, category_parent) VALUES ('0', '$cat_name', '$category_nicename', '$category_description', '$cat')";
-	else
-		$query = "UPDATE $wpdb-&amp;gt;categories SET cat_name = '$cat_name', category_nicename = '$category_nicename', category_description = '$category_description', category_parent = '$category_parent' WHERE cat_ID = '$cat_ID'";
+	if (!$update) {
+		$wpdb-&amp;gt;query( "INSERT INTO $wpdb-&amp;gt;categories (cat_ID, cat_name, category_nicename, category_description, category_parent) VALUES ('0', '$cat_name', '$category_nicename', '$category_description', '$category_parent')" );
+		$cat_ID = $wpdb-&amp;gt;insert_id;
+	} else {
+		$wpdb-&amp;gt;query( "UPDATE $wpdb-&amp;gt;categories SET cat_name = '$cat_name', category_nicename = '$category_nicename', category_description = '$category_description', category_parent = '$category_parent' WHERE cat_ID = '$cat_ID'" );
+	}
+	if ( $category_nicename == '' ) {
+		$category_nicename = sanitize_title($cat_name, $cat_ID );
+		$wpdb-&amp;gt;query( "UPDATE $wpdb-&amp;gt;categories SET category_nicename = '$category_nicename' WHERE cat_ID = '$cat_ID'" );
+	}
-	$result = $wpdb-&amp;gt;query($query);
-
 	if ($update) {
 		do_action('edit_category', $cat_ID);
 	} else {
-		do_action('create_category', $rval);
-		do_action('add_category', $rval);
+		do_action('create_category', $cat_ID);
+		do_action('add_category', $cat_ID);
 	}
 	return $cat_ID;
&lt;/pre&gt;</description>
      <category>newticket</category>
    </item><item>
      <title>Ticket #1749 (Global Variables are not available in Plugin functions) created</title>
      
        <dc:creator>mani_monaj</dc:creator>

      <pubDate>Wed, 12 Oct 2005 07:48:14 GMT</pubDate>
      <link>http://core.trac.wordpress.org/ticket/1749</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/ticket/1749/1129103294000000</guid>
      <description>&lt;p&gt;
I've just tested out some plugins on Wordpress 1.6 that used to work in ver 1.5 , After an hour of debugging I found out that global variables are not available in plugin functions , for example
&lt;/p&gt;
&lt;pre class="wiki"&gt;function mps_jalali_query($where) {
	global $m,$hour,$minute,$second,$year,$monthnum,$day;
...
...
}
...
add_filter("posts_where","mps_jalali_query");
&lt;/pre&gt;&lt;p&gt;
but $m, $hour, $minute , etc are not available in the function , they are NULL in the function !
&lt;/p&gt;
</description>
      <category>newticket</category>
    </item><item>
      <title>wp-1.5.2-patch_xmlrpc.php attached to Ticket #1744</title>
      
        <dc:creator>pidge</dc:creator>

      <pubDate>Wed, 12 Oct 2005 01:51:43 GMT</pubDate>
      <link>http://core.trac.wordpress.org/attachment/ticket/1744/wp-1.5.2-patch_xmlrpc.php</link>
      <guid isPermaLink="false">http://core.trac.wordpress.org/attachment/ticket/1744/wp-1.5.2-patch_xmlrpc.php/1129081903000000</guid>
      <description>&lt;p&gt;
Fix for this issue
&lt;/p&gt;
</description>
      <category>attachment</category>
    </item>
   </channel>
</rss>